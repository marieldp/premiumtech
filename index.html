<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M & J Wedding</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Great+Vibes&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
    <style>
        /* ENVELOPE CONTAINER */
#envelope-wrapper { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100vh; 
    z-index: 2000; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    background-color: #e5e0d8; /* The table surface color */
    perspective: 1500px; /* Crucial for the 3D flip effect */
}

/* THE ENVELOPE BODY */
.envelope {
    position: relative;
    width: 100%;
    max-width: 600px;
    height: 400px;
    background: #fcfaf7; /* Inner paper color */
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

/* THE FLAPS */
.flap { 
    position: absolute; 
    width: 100%; 
    height: 100%; 
    background-image: url('6938.jpg'); 
    background-repeat: repeat;
    transition: all 1s cubic-bezier(0.645, 0.045, 0.355, 1);
    z-index: 1000;
}

/* THE TOP FLAP (The Triangle Piece) */
.top-flap { 
    top: 0; 
    height: 50%;
    clip-path: polygon(0 0, 100% 0, 50% 100%); /* Makes it a triangle */
    transform-origin: top;
    z-index: 1002;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

/* THE BOTTOM & SIDES (The Pocket) */
.bottom-flap { 
    bottom: 0; 
    height: 100%;
    clip-path: polygon(0 100%, 100% 100%, 100% 50%, 50% 50%, 0 50%); /* The 'pocket' shape */
    z-index: 1001;
    box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
}

/* THE SEAL STAMP */
#seal { 
    position: absolute; 
    top: 50%;
    left: 50%;
    width: 110px; 
    height: 110px; 
    transform: translate(-50%, -50%);
    background: url('seal.png') no-repeat center; 
    background-size: contain;
    z-index: 1003; 
    cursor: pointer; 
    filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); 
    transition: all 0.5s ease;
}

/* OPEN ANIMATION LOGIC */
.open .top-flap { 
    transform: rotateX(180deg); /* Flips the triangle UP */
    z-index: 1000; /* Moves it behind the letter */
}

.open #seal { 
    opacity: 0; 
    transform: translate(-50%, -80%) scale(0.8);
    pointer-events: none; 
}

/* Slide the whole envelope down and away after the flip */
.open-exit {
    transform: translateY(100vh);
    transition: transform 1s ease-in-out 0.8s;
}
</head>
<body style="overflow: hidden;">

    <div id="envelope-wrapper">
        <div class="flap top-flap"></div>
        <div id="seal" onclick="openInvitation()"><span>M & J</span></div>
        <div class="flap bottom-flap"></div>
    </div>

    <div id="main-site">
        
    <section style="height: 100vh; width: 100%; background: url('1.jpg') center/cover no-repeat; display: flex; align-items: center; justify-content: flex-end; position: relative; overflow: hidden;">
    
    <div style="
        position: absolute; 
        top: 0; 
        right: 0; 
        width: 100%; 
        height: 100%; 
        background: linear-gradient(to right, rgba(4, 57, 39, 0) 20%, rgba(4, 57, 39, 0.3) 50%, rgba(4, 57, 39, 0.8) 100%); 
        z-index: 1;">
    </div>

    <div style="position: relative; padding-right: 10vw; text-align: right; z-index: 2;">
        <h1 style="font-family: 'Great Vibes', cursive; font-size: clamp(55px, 8vw, 110px); color: #d4af37; margin: 0; line-height: 1.1; text-shadow: 2px 2px 15px rgba(0,0,0,0.6);">
            Mariel <br> 
            <span style="font-family: 'Georgia', serif; font-size: 0.3em; letter-spacing: 10px; color: #f4cfe0; vertical-align: middle;">&</span> <br>
            Jasper
        </h1>
        
        <div style="width: 80px; height: 1px; background: #d4af37; margin: 25px 0 25px auto;"></div>
        
        <p style="font-family: 'Georgia', serif; letter-spacing: 5px; font-size: clamp(14px, 1.5vw, 18px); text-transform: uppercase; color: #fff; text-shadow: 1px 1px 5px rgba(0,0,0,0.5);">
            November 06, 2027
        </p>
        
        <p style="font-family: 'Georgia', serif; font-style: italic; color: #f4cfe0; margin-top: 8px; font-size: 16px;">
            Save the Date
        </p>

        <div style="margin-top: 60px; font-size: 11px; letter-spacing: 4px; color: #d4af37; text-transform: uppercase;">
            Scroll to RSVP <span style="display:block; margin-top: 10px;">↓</span>
        </div>
    </div>
</section>

        <section style="padding: 100px 20px; background-color: #fdf0f5; color: #043927; text-align: center;">
            <h2 style="font-family: 'Great Vibes', cursive; font-size: 45px; margin-bottom: 50px;">The Journey to Forever</h2>
            <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-start; gap: 60px; max-width: 1000px; margin: 0 auto;">
                <div style="flex: 1; min-width: 300px; max-width: 400px;">
                    <div style="border: 1px solid #d4af37; padding: 10px; background: #fff; box-shadow: 15px 15px 0px #043927;">
                        <img src="2.jpg" style="width: 100%; height: auto; display: block;">
                    </div>
                </div>
                <div style="flex: 1; min-width: 300px; max-width: 400px; margin-top: 80px;">
                    <div style="border: 1px solid #d4af37; padding: 10px; background: #fff; box-shadow: -15px 15px 0px var(--pink);">
                        <img src="3.jpg" style="width: 100%; height: auto; display: block;">
                    </div>
                </div>
            </div>
        </section>

        <section style="padding: 80px 20px; background-color: #fcfaf7; color: #043927; text-align: center;">
    <div style="max-width: 900px; margin: 0 auto;">
        <h2 style="font-family: 'Great Vibes', cursive; font-size: 45px; color: #d4af37; margin-bottom: 40px;">The Celebration</h2>
        
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 40px;">
            
            <div style="flex: 1; min-width: 280px; padding: 30px; border: 1px solid #f4cfe0; background: white; box-shadow: 10px 10px 0px #043927;">
                <h3 style="font-family: 'Playfair Display'; letter-spacing: 2px; text-transform: uppercase; font-size: 1.2rem;">The Ceremony</h3>
                <p style="color: #d4af37; font-weight: bold; margin: 15px 0 5px;">2:00 IN THE AFTERNOON</p>
                <p style="font-family: 'Georgia', serif; line-height: 1.6;">
                    <strong>Santuario de San Antonio Parish</strong><br>
                    3117 McKinley Rd, Forbes Park, Makati City, 1220 Metro Manila
                </p>
                <a href="https://maps.app.goo.gl/..." target="_blank" style="display: inline-block; margin-top: 15px; color: #8b7d6b; font-size: 0.8rem; letter-spacing: 1px;">VIEW MAP →</a>
            </div>

            <div style="flex: 1; min-width: 280px; padding: 30px; border: 1px solid #f4cfe0; background: white; box-shadow: 10px 10px 0px #f4cfe0;">
                <h3 style="font-family: 'Playfair Display'; letter-spacing: 2px; text-transform: uppercase; font-size: 1.2rem;">The Reception</h3>
                <p style="color: #d4af37; font-weight: bold; margin: 15px 0 5px;">4:00 IN THE AFTERNOON</p>
                <p style="font-family: 'Georgia', serif; line-height: 1.6;">
                    <strong>The Blue Leaf</strong><br>
                    100 Park Avenue, McKinley Hill Village, Taguig, 1633 Metro Manila
                </p>
                <a href="https://maps.app.goo.gl/..." target="_blank" style="display: inline-block; margin-top: 15px; color: #8b7d6b; font-size: 0.8rem; letter-spacing: 1px;">VIEW MAP →</a>
            </div>

        </div>
    </div>
</section>

<section style="padding: 100px 0; background-color: #043927; text-align: center;">
    <div style="max-width: 1000px; margin: 0 auto; padding: 0 20px;">
        <h2 style="font-family: 'Great Vibes', cursive; font-size: 40px; color: #d4af37; margin-bottom: 30px;">Our Story in Motion</h2>
        
        <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border: 1px solid #d4af37; box-shadow: 0 20px 50px rgba(0,0,0,0.5);">
            <iframe 
                src="https://www.youtube.com/embed/8RjcJXikhrk?rel=0" 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
            </iframe>
        </div>

        <p style="margin-top: 25px; font-family: 'Georgia', serif; font-style: italic; color: #f4cfe0; letter-spacing: 2px;">
            Jasper & Mariel
        </p>
    </div>
</section>

        <section style="padding: 80px 20px; background: white; text-align: center;">
            <div style="max-width: 500px; margin: 0 auto;">
                <div id="loading" class="hidden">Checking invitation...</div>
                <div id="content" class="rsvp-card hidden"></div>
                <div id="error-msg" class="hidden rsvp-card"><p>Guest not found. Please use the original link.</p></div>
            </div>
        </section>

    </div>

    <script>
        const webAppUrl = "https://script.google.com/macros/s/AKfycbw-f-QuQTu7ry8YYVF3TE5EYTFLenryQzEgdY96rmSetu3dU659hJGhhKZQtP3GfsLc/exec"; 
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('id');
        let guestData = null;

        function openInvitation() {
    const wrapper = document.getElementById('envelope-wrapper');
    wrapper.classList.add('open'); // Starts the flap flip
    
    // Wait for the flip to finish, then slide the whole thing away
    setTimeout(() => {
        wrapper.classList.add('open-exit');
        document.body.classList.add('show-site');
        document.getElementById('main-site').style.display = 'block';
        document.body.style.overflow = 'auto';
    }, 800);

    if (token) {
        document.getElementById('loading').classList.remove('hidden');
        checkGuestStatus();
    } else {
        document.getElementById('error-msg').classList.remove('hidden');
    }
}
        function checkGuestStatus() {
            fetch(`${webAppUrl}?id=${encodeURIComponent(token)}`, { method: "GET", redirect: "follow" })
            .then(res => res.json())
            .then(data => {
                guestData = data; 
                document.getElementById('loading').classList.add('hidden');
                if (data.name) {
                    data.isDone ? showDoneView(data) : showMainForm();
                } else { 
                    document.getElementById('error-msg').classList.remove('hidden'); 
                }
            })
            .catch(err => {
                document.getElementById('loading').innerHTML = "Connection Error. Please refresh.";
            });
        }

        function showDoneView(data) {
            const content = document.getElementById('content');
            content.classList.remove('hidden');
            content.innerHTML = `
                <div style="text-align: center;">
                    <h2 style="font-family: 'Playfair Display';">Thank you!</h2>
                    <p>RSVP recorded for ${data.name}.</p>
                    <div style="margin-top: 20px;">
                        <a href="#" onclick="event.preventDefault(); showMainForm();" style="color: #888; text-decoration: underline; font-size: 0.8rem;">
                            Edit your response
                        </a>
                    </div>
                </div>`;
        }

        function showMainForm() {
            const content = document.getElementById('content');
            content.classList.remove('hidden');
            const canP1 = String(guestData.allowPlusOne).toLowerCase() === "true";

            content.innerHTML = `
                <h2 style="font-family: 'Playfair Display';">Hi ${guestData.name},</h2>
                <label>Will you attend?</label>
                <select id="attending-select" onchange="togglePlusOne(${canP1})">
                    <option value="Yes">Yes, I'll be there!</option>
                    <option value="No">No, I can't make it</option>
                </select>
                <div id="p1-area"></div>
                <label>Email Address</label>
                <input type="email" id="guest-email" value="${guestData.email || ''}">
                <label>Message to the couple</label>
                <textarea id="guest-note">${guestData.note || ''}</textarea>
                <button class="btn" id="submit-btn" onclick="submitRSVP()">Confirm RSVP</button>`;
            togglePlusOne(canP1);
        }

        function togglePlusOne(canP1) {
            const area = document.getElementById('p1-area');
            const attending = document.getElementById('attending-select').value;
            if (attending === "Yes" && canP1) {
                area.innerHTML = `
                    <label>Bringing a plus one?</label>
                    <select id="bringing-p1" onchange="toggleP1Name()">
                        <option value="No">No</option>
                        <option value="Yes">Yes</option>
                    </select>
                    <div id="p1-name-wrapper"></div>`;
            } else { area.innerHTML = ''; }
        }

        function toggleP1Name() {
            const wrapper = document.getElementById('p1-name-wrapper');
            if (document.getElementById('bringing-p1').value === "Yes") {
                wrapper.innerHTML = '<label>Plus One Name</label><input type="text" id="plus-one-name" placeholder="Guest Name">';
            } else { wrapper.innerHTML = ''; }
        }

        function submitRSVP() {
            const btn = document.getElementById('submit-btn');
            btn.disabled = true; btn.innerHTML = "Saving...";
            const p1NameInput = document.getElementById('plus-one-name');
            const payload = {
                token: token,
                name: guestData.name,
                email: document.getElementById('guest-email').value,
                attending: document.getElementById('attending-select').value,
                plusOneName: p1NameInput ? p1NameInput.value : "None",
                note: document.getElementById('guest-note').value
            };
            fetch(webAppUrl, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) })
            .then(() => { showDoneView({ ...guestData }); });
        }
    </script>
</body>
</html>
